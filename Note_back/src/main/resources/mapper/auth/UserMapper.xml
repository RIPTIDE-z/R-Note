<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.riptidez.notebackend.auth.mapper.UserMapper">

    <!-- 映射 User 实体 -->
    <resultMap id="UserResultMap" type="User">
        <id     property="id"            column="id"/>
        <result property="username"      column="username"/>
        <result property="passwordHash"  column="password_hash"/>
        <result property="noteStructure" column="note_structure"/>
    </resultMap>

    <!-- 不带密码和笔记结构的 User 实体 用于查询-->
    <resultMap id="UserBasicResultMap" type="User">
        <id     property="id"       column="id"/>
        <result property="username" column="username"/>
    </resultMap>

    <!-- 根据用户名查询用户 ，不查密码和笔记结构-->
    <select id="findByUsername" parameterType="string" resultMap="UserBasicResultMap">
        SELECT id,
               username
        FROM user
        WHERE username = #{username}
        LIMIT 1
    </select>

    <!-- 根据 id 查询用户 ， 不查密码和笔记结构-->
    <select id="findById" parameterType="long" resultMap="UserBasicResultMap">
        SELECT id,
               username
        FROM user
        WHERE id = #{id}
    </select>

    <!-- 插入新用户，主键自增 -->
    <insert id="insert" parameterType="User" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO user (
            username,
            password_hash,
            note_structure
        ) VALUES (
                     #{username},
                     #{password},
                     #{noteStructure}
                 )
    </insert>

    <!-- 更新用户的 note_structure -->
    <update id="updateNoteStructure">
        UPDATE user
        SET note_structure = #{noteStructure}
        <!-- 如果有 updated_time，可以顺便更新：
             , updated_time = NOW()
        -->
        WHERE id = #{id}
    </update>

</mapper>